{% extends "layout.html" %}

{% block title %}
  {{ listing.municipality }} {{ listing.rooms }} h
  {{ listing.size | format_size }} m²
  {{ listing.rent }} €
{% endblock %}

{% block content %}

<section class="hero">
  <h2>
    {{ listing.municipality }} {{ listing.rooms }} h
    {{ listing.size | format_size }} m²
    {{ listing.rent }} €
  </h2>

  <h4>Tykkäyksiä: {{ likes.likes }}</h4>

  {% if session.user_id != listing.user_id %}
    <form action="/toggle_like/{{ listing.id }}" method="post">
      <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
      <button type="submit">
        {% if likes.liked %}
          Poista tykkäys
        {% else %}
          Tykkää
        {% endif %}
      </button>
    </form>
  {% endif %}
</section>


{% if images %}
<section class="wide">
  <div class="listing-card">
    <h3>Kuvat</h3>

    <div class="grid grid-large">
      {% for image in images %}
        <div>
          <img src="/image/{{ image.id }}" alt="Listing image" style="width:100%; border-radius:12px;">
        </div>
      {% endfor %}
    </div>

    {% if session.user_id == listing.user_id %}
      <div class="center">
        <form action="/images/{{ listing.id }}" method="get">
          <button type="submit">Muokkaa kuvia</button>
        </form>
      </div>
    {% endif %}
  </div>
</section>
{% endif %}


<section class="wide">
  <div class="listing-card">
    <h3>Asunnon tiedot</h3>

    <div class="grid grid-dual">
      <p><strong>Asuntotyyppi:</strong> {{ listing.property_type }}</p>
      <p><strong>Huonemäärä:</strong> {{ listing.rooms }} h</p>
      <p><strong>Neliömäärä:</strong> {{ listing.size | format_size }} m²</p>
      <p><strong>Vuokrahinta:</strong> {{ listing.rent }} €</p>
      <p><strong>Kunto:</strong> {{ listing.condition }}</p>
      <p><strong>Parveke:</strong> {{ "Kyllä" if listing.balcony else "Ei" }}</p>
      <p><strong>Sauna:</strong> {{ "Kyllä" if listing.sauna else "Ei" }}</p>
      {% if listing.floor %}
        <p><strong>Kerros:</strong> {{ listing.floor }} / {{ listing.floors }}</p>
      {% else %}
        <p><strong>Kerroksia:</strong> {{ listing.floors }}</p>
      {% endif %}
    </div>

    <p><strong>Kuvaus</strong></p>
    <p>{{ listing.description | show_lines }}</p>

    {% if listing.property_type == "Kerrostalo" %}
      <h3>Taloyhtiön tiedot</h3>

      <div class="grid grid-dual">
        <p><strong>Sauna:</strong> {{ "Kyllä" if listing.bath else "Ei" }}</p>
        <p><strong>Hissi:</strong> {{ "Kyllä" if listing.elevator else "Ei" }}</p>
        <p><strong>Pyykkitupa:</strong> {{ "Kyllä" if listing.laundry else "Ei" }}</p>
        <p><strong>Häkkikellari:</strong> {{ "Kyllä" if listing.cellar else "Ei" }}</p>
        <p><strong>Uima-allas:</strong> {{ "Kyllä" if listing.pool else "Ei" }}</p>
      </div>
    {% endif %}

    {% if session.user_id == listing.user_id %}
      <div class="center">
        <form action="/edit_listing/{{ listing.id }}" method="get">
          <button type="submit">Muokkaa tietoja</button>
        </form>
      </div>
    {% endif %}
  </div>
</section>


{% if session.user_id == listing.user_id %}
<section class="medium center">
  <form action="/remove_listing/{{ listing.id }}" method="get">
    <button type="submit" style="background:#c62828;">
      Poista ilmoitus
    </button>
  </form>
</section>
{% endif %}

{% endblock %}