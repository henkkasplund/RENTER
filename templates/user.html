{% extends "layout.html" %}

{% block title %}{{ user.username }}{% endblock %}

{% block content %}

<section class="hero">
  <h2>{{ user.username }}</h2>
  <h4>Luokitus: {{ user.rating }}</h4>
</section>

{% if rating_permission %}
<section class="narrow center">
  <h3>Anna luokitus</h3>

  <form class="form-stack" action="/rate_user/{{ user.id }}" method="post">
    <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">

    <select name="rating">
      {% for i in range(0, 6) %}
        <option value="{{ i }}" {% if user_rating == i %}selected{% endif %}>
          {{ i }}
        </option>
      {% endfor %}
    </select>

    <div class="center">
      <button type="submit">Tallenna luokitus</button>
    </div>
  </form>
</section>
{% endif %}

{% if session.user_id == user.id %}
<section class="wide">
  <div class="listing-card left">
    <h3>Yhteystiedot</h3>

    {% if edit_contact %}
      <form class="form-stack" action="/user/{{ user.id }}" method="post">
        <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">

        <label>
          Puhelin
          <input type="text" name="phone" value="{{ user.phone or '' }}" maxlength="30">
        </label>

        <label>
          Sähköposti
          <input type="text" name="email" value="{{ user.email or '' }}" maxlength="50">
        </label>

        <div class="center">
          <button type="submit">Päivitä yhteystiedot</button>
        </div>
      </form>

    {% else %}
      <p>Puhelin: {{ user.phone or "-" }}</p>
      <p>Sähköposti: {{ user.email or "-" }}</p>

      <form action="/user/{{ user.id }}" method="get">
        <input type="hidden" name="edit_contact" value="1">
        <button type="submit">Muokkaa yhteystietoja</button>
      </form>
    {% endif %}
  </div>
</section>
{% endif %}

{% if session.user_id != user.id %}
<section class="wide">
  <h3>{{ user.username }}n ilmoitukset</h3>

  {% if listings %}
    <div class="grid grid-large">
      {% for listing in listings %}
        <div class="listing-card">
          <a href="/listing/{{ listing.id }}">
            <h4>{{ listing.municipality }} {{ listing.rooms }}h</h4>
            <p>{{ listing.size | format_size }} m²</p>
            <p class="price">{{ listing.rent }} €</p>
          </a>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>Ei ilmoituksia.</p>
  {% endif %}
</section>
{% endif %}

{% if session.user_id == user.id %}

<section class="wide">
  <h3>Omat ilmoitukset</h3>

  {% if listings %}
    <div class="grid grid-large">
      {% for listing in listings %}
        <div class="listing-card">
          <a href="/listing/{{ listing.id }}">
            <h4>{{ listing.municipality }} {{ listing.rooms }}h</h4>
            <p>{{ listing.size | format_size }} m²</p>
            <p class="price">{{ listing.rent }} €</p>
          </a>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="listing-card">
      <p>Sinulla ei ole aktiivisia ilmoituksia.</p>
    </div>
  {% endif %}
</section>

<section class="wide">
  <h3>Omat hakemukset</h3>

  {% if sent_offers %}
    <div class="grid grid-large">
      {% for offer in sent_offers %}
        <div class="listing-card">
          <a href="/listing/{{ offer.listing_id }}">
            <h4>{{ offer.municipality }} {{ offer.rooms }}h</h4>
            <p>{{ offer.size | format_size }} m²</p>
            <p class="price">{{ offer.rent }} €</p>
          </a>

          <p>
            {% if offer.owner_accepted %}
              <strong>Hyväksytty</strong>
            {% else %}
              <strong>Odottaa</strong>
            {% endif %}
          </p>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="listing-card">
      <p>Et ole lähettänyt hakemuksia.</p>
    </div>
  {% endif %}
</section>

<section class="wide">
  <h3>Saapuneet hakemukset</h3>

  {% if received_offers %}
    <div class="grid grid-large">
      {% for offer in received_offers %}
        <div class="listing-card">
          <a href="/listing/{{ offer.listing_id }}">
            <h4>{{ offer.municipality }} {{ offer.rooms }}h</h4>
            <p>{{ offer.size | format_size }} m²</p>
            <p class="price">{{ offer.rent }} €</p>
          </a>

          <p>
            Hakija:
            <a href="/user/{{ offer.tenant_id }}">
              {{ offer.tenant_username }}
            </a>
          </p>

          <p>Tarjous: {{ offer.price }} €</p>

          {% if offer.owner_accepted %}
            <strong>Hyväksytty</strong>
          {% else %}
            <strong>Odottaa</strong>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="listing-card">
      <p>Ei saapuneita hakemuksia.</p>
    </div>
  {% endif %}
</section>

{% endif %}

{% if session.user_id == user.id %}
<section class="medium center">
  <form action="/delete_account" method="get">
    <button type="submit" style="background:#c62828;">Poista käyttäjätili</button>
  </form>
</section>
{% endif %}

{% endblock %}